"use strict";class RewardMap{constructor(t,i,s,a){this.rows=t,this.columns=i,this.cliffs=s,this.reward=a,this.matrix={},this.generateRewards()}generateRewards(){for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++){var s=t.toString()+"x"+i.toString();this.matrix[s]=-1}for(var a of this.cliffs)this.matrix[a]=-100;this.matrix[this.reward]=100}}class QMatrix{constructor(t,i){this.matrix={},this.rows=t,this.columns=i,this.generateMatrix()}generateMatrix(){for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++){var s=t.toString()+"x"+i.toString();this.matrix[s]=[0,0,0,0]}}}class QLearningAgent{constructor(t,i){this.map=t,this.qMatrix=new QMatrix(t.rows,t.columns),this.initialPosition=i,this.state=this.initialPosition,this.nextState=null,this.action=null}getCoordinates(t){var i=t.match(/\d+/g);return[parseInt(i[0]),parseInt(i[1])]}getStateId(t,i){return t.toString()+"x"+i.toString()}getAllowedDirections(t){var i,s,a=[];return[i,s]=this.getCoordinates(t),i>0&&a.push("UP"),s<this.map.columns-1&&a.push("RIGHT"),i<this.map.rows-1&&a.push("DOWN"),s>0&&a.push("LEFT"),a}getNeighborhood(t){var i,s,a=[];return[i,s]=this.getCoordinates(t),i>0&&a.push(this.getStateId(i-1,s)),s<this.map.columns-1&&a.push(this.getStateId(i,s+1)),i<this.map.rows-1&&a.push(this.getStateId(i+1,s)),s>0&&a.push(this.getStateId(i,s-1)),a}directionMapping(t){return"UP"==t?0:"RIGHT"==t?1:"DOWN"==t?2:"LEFT"==t?3:void 0}getNextState(t){var i,s;return[i,s]=this.getCoordinates(this.state),"UP"==t?this.getStateId(i-1,s):"RIGHT"==t?this.getStateId(i,s+1):"DOWN"==t?this.getStateId(i+1,s):"LEFT"==t?this.getStateId(i,s-1):void 0}epsilonGreedy(t){var i=this.getAllowedDirections(this.state);if(Math.random()<t)return i[Math.floor(Math.random()*i.length)];var s=this.getNeighborhood(this.state),a={};for(var r in s){var e=s[r],h=i[r];a[e]=this.qMatrix.matrix[this.state][this.directionMapping(h)]}var n=Math.max.apply(Math,Object.values(a)),o=Object.entries(a).filter(([t,i])=>i==n),g=o[Math.floor(Math.random()*o.length)][0];return i[Object.keys(a).indexOf(g)]}move(t){var i=this.epsilonGreedy(t);this.action=this.directionMapping(i),this.nextState=this.getNextState(i)}findQMax(t){return Math.max(...this.qMatrix.matrix[t])}updateQ(t,i){this.qMatrix.matrix[this.state][this.action]=this.qMatrix.matrix[this.state][this.action]+t*(this.map.matrix[this.nextState]+i*this.findQMax(this.nextState)-this.qMatrix.matrix[this.state][this.action])}}export{RewardMap,QLearningAgent};