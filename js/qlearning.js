"use strict";class RewardMap{constructor(t,i){this.rows=t,this.columns=i,this.matrix={},this.generateRewards()}generateRewards(){for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++){var s=t.toString()+"x"+i.toString();this.matrix[s]=-1}this.matrix["2x1"]=-100,this.matrix["2x2"]=-100,this.matrix["2x3"]=100}}class QMatrix{constructor(t,i){this.matrix={},this.rows=t,this.columns=i,this.generateMatrix()}generateMatrix(){for(var t=0;t<this.rows;t++)for(var i=0;i<this.columns;i++){var s=t.toString()+"x"+i.toString();this.matrix[s]=[0,0,0,0]}}}class QLearningAgent{constructor(t){this.map=t,this.qMatrix=new QMatrix(t.rows,t.columns),this.initialPosition="2x0",this.state=this.initialPosition,this.nextState=null,this.action=null}getCoordinates(t){var i=t.match(/\d+/g);return[parseInt(i[0]),parseInt(i[1])]}getStateId(t,i){return t.toString()+"x"+i.toString()}getAllowedDirections(t){var i,s,e=[];return[i,s]=this.getCoordinates(t),i>0&&e.push("UP"),s<this.map.columns-1&&e.push("RIGHT"),i<this.map.rows-1&&e.push("DOWN"),s>0&&e.push("LEFT"),e}getNeighborhood(t){var i,s,e=[];return[i,s]=this.getCoordinates(t),i>0&&e.push(this.getStateId(i-1,s)),s<this.map.columns-1&&e.push(this.getStateId(i,s+1)),i<this.map.rows-1&&e.push(this.getStateId(i+1,s)),s>0&&e.push(this.getStateId(i,s-1)),e}directionMapping(t){return"UP"==t?0:"RIGHT"==t?1:"DOWN"==t?2:"LEFT"==t?3:void 0}getNextState(t){var i,s;return[i,s]=this.getCoordinates(this.state),"UP"==t?this.getStateId(i-1,s):"RIGHT"==t?this.getStateId(i,s+1):"DOWN"==t?this.getStateId(i+1,s):"LEFT"==t?this.getStateId(i,s-1):void 0}epsilonGreedy(t){var i=this.getAllowedDirections(this.state);if(console.log(i),console.log("Epsilon Greedy"),Math.random()<t)return i[Math.floor(Math.random()*i.length)];var s=this.getNeighborhood(this.state),e={};for(var a in s){var o=s[a],r=i[a];e[o]=this.qMatrix.matrix[this.state][this.directionMapping(r)]}console.log("HIII"),console.log(e);var h=Math.max.apply(Math,Object.values(e)),n=Object.entries(e).filter(([t,i])=>i==h),l=n[Math.floor(Math.random()*n.length)][0],g=Object.keys(e).indexOf(l);return console.log("Choosen next state: "+l),console.log(g),console.log(i[g]),i[g]}move(t){var i=this.epsilonGreedy(t);console.log("Let's go "+i),this.action=this.directionMapping(i),console.log(this.getNextState(i)),this.nextState=this.getNextState(i),console.log(this.nextState)}findQMax(t){var i=this.getNeighborhood(t);return console.log(i),console.log(this.qMatrix.matrix[t]),Math.max(...this.qMatrix.matrix[t])}updateQ(t,i){console.log(this.qMatrix.matrix[this.state][this.action]),this.qMatrix.matrix[this.state][this.action]=this.qMatrix.matrix[this.state][this.action]+t*(this.map.matrix[this.nextState]+i*this.findQMax(this.nextState)-this.qMatrix.matrix[this.state][this.action]),console.log("NEW q value"),console.log(this.qMatrix.matrix[this.state][this.action])}}export{RewardMap,QLearningAgent};